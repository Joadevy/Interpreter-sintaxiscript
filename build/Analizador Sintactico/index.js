var __awaiter=this&&this.__awaiter||function(o,a,e,t){return new(e||(e=Promise))((function(i,r){function n(o){try{s(t.next(o))}catch(o){r(o)}}function l(o){try{s(t.throw(o))}catch(o){r(o)}}function s(o){var a;o.done?i(o.value):(a=o.value,a instanceof e?a:new e((function(o){o(a)}))).then(n,l)}s((t=t.apply(o,a||[])).next())}))};import{nodo,Arbol}from"./manejoArbol.js";import{creaTAS,cargarTAS,variables,terminales}from"./TAS.js";import{tablaSimbolos as TS}from"../Analizador Lexico/tablaSimbolos.js";import{obtenerSiguienteCompLex}from"../Analizador Lexico/index.js";import{crearPila,Apilar,Desapilar}from"./manejoPila.js";import{evaluarPrograma}from"../Analizador Semantico/index.js";const arrayVariables=["vPROGRAMA","vCUERPO","vSENTENCIAS","vSENTENCIA","vDECLARACION","vVARIABLES","vVARIABLE","vASIGNACION","vEXPARIT","vIZQARIT","vRAIZPOT","vPOT","vSUMARESTA","vMULTDIV","vOPERANDOS","vLECTURA","vESCRITURA","vSALIDAS","vSAUX","vSALIDA","vCONDICIONAL","vCONDICIONALFACT","vMIENTRAS","vCONDICION","vIZQCOND","vNEGACION","vCONJUNCION","vDISYUNCION"],arrayTerminales=["tPrograma","tEscribir","tVariables","tLeer","tWhile","tIf","tElse","tAnd","tOr","tNot","tId","tCadena","tConstReal","tPuntoComa","tComa","tOpRel","tOpAsignacion","tSuma","tResta","tProducto","tDivision","tPotencia","tRaiz","tParentesisAbre","tParentesisCierra","tLlaveAbre","tLlaveCierra","tCorcheteAbre","tCorcheteCierra","tPunto"];function inicializarPila(o,a){o=crearPila();let e={simbolo:"vPROGRAMA",arbolPila:a};return Apilar(o,{simbolo:"pesos"}),Apilar(o,e),o}export function analisisSintactico(o,a,e){var t,i,r,n;let l,s=!1,c="",m=0,d="",A=creaTAS(),u=crearPila(),v=TS;cargarTAS(A),u=inicializarPila(u,a);let p,b=obtenerSiguienteCompLex(o,m,v);for(l=b[0],d=b[2],v=b[3],m=b[1];"errorLexico"!==l&&!s;){if(p=Desapilar(u),arrayTerminales.includes(p.simbolo))p.simbolo==l?(p.arbolPila&&(p.arbolPila.lexema=d),b=obtenerSiguienteCompLex(o,m,v),l=b[0],b[3]&&(v=b[3]),d=b[2],m=b[1]):(c=" se esperaba "+p.simbolo+" y se encontro "+l,l="errorLexico");else if(arrayVariables.includes(p.simbolo)){let o=variables[p.simbolo],a=terminales[l];if(void 0===A[o][a])c="<< TAS no definida para "+p.simbolo+" hacia "+l+" >>",l="errorLexico";else{let e=0,l=A[o][a].cantidad-1;for(;e<=l;){let i=A[o][a].elementos[e],r=new nodo(i,"",0,[]);null===(t=p.arbolPila)||void 0===t||t.insertarHijo(r),e++}for(;l>=0;){if(null===(i=p.arbolPila)||void 0===i?void 0:i.hijos[l].simbolo){let o={simbolo:null===(r=p.arbolPila)||void 0===r?void 0:r.hijos[l].simbolo,arbolPila:null===(n=p.arbolPila)||void 0===n?void 0:n.hijos[l]};Apilar(u,o)}l--}}}p.simbolo==l&&"pesos"==l&&(s=!0)}s?e?evaluarPrograma(a):mostrarInfoSintactico([!0],a):(console.log("******  Hay un error sintactico ******"),mostrarInfoSintactico([!1,c],a))}export function analizadorSintactico(o,a){return __awaiter(this,void 0,void 0,(function*(){let e=(yield o.text()).trim();const t=new nodo("vPROGRAMA","",0,[]);analisisSintactico(e,new Arbol(t),a)}))}function mostrarInfoSintactico(o,a){let e=document.getElementById("output");if(o[0]){const o=document.createElement("p"),t=document.createElement("div");t.classList.add("arbolSintactico"),o.classList.add("output-text"),o.innerHTML="Â» No hay errores sintacticos, se ha generado el arbol sintactico: <br><br>",e&&(e.appendChild(o),e.appendChild(t),e.classList.add("output-show"),a.mostrarArbol(a,""))}else{if(!e){const o=document.getElementById("main"),a=document.getElementById("template-output").content.cloneNode(!0);o.appendChild(a),e=document.getElementById("output")}if(e){let a=document.createElement("p");a.classList.add("output-text"),a.innerHTML=`Ocurrio un <span class="error">error sintactico.</span> Log: <span class="complex">${o[1]}</span>`,e.appendChild(a),e.classList.add("output-show")}}}